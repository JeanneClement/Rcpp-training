---
classoption: table, dvipsname
colorlinks: no
fontsize: 10pt
link-citations: yes
linkcolor: Black
output:
  beamer_presentation:
    includes:
      after_body: doc_suffix.tex
      before_body: doc_prefix.tex
      in_header: header.tex
    slide_level: 3
urlcolor: Maroon
---

```{r options, include=FALSE}
library(knitr)
library(kableExtra)
opts_chunk$set(echo=TRUE, cache=TRUE,
               #results="hide", 
               warning=FALSE,
               message=FALSE, highlight=TRUE,
               fig.show="hide", size="small",
               fig.align="center",
               tidy=FALSE)
options(knitr.kable.NA="-")
```

\frametitle{Outline}
  \begin{columns}[c]
    \begin{column}{0.5\textwidth}
      \tableofcontents[sections=1]
    \end{column}
      \begin{column}{0.5\textwidth}
      \tableofcontents[sections=2]
      \vspace{0.5cm}
      \tableofcontents[sections=3]
      \vspace{0.5cm}
      \tableofcontents[sections=4]
    \end{column}
  \end{columns}

<!-- ================================================================= -->
<!-- PART 1: Rcpp* packages -->
<!-- ================================================================= -->

# Short presentation of Rcpp* packages

## Rcpp : extending R with C++

### Rcpp R package

- **Rcpp** is an R package to extend R with C++ code

- Main advantage: C++ is fast, it accelerates R (see next sections)

- Written by **Dirk EDDELBUETTEL** and **Romain FRANCOIS**

- <http://www.rcpp.org/>

### Simple Rcpp example

**C++ code** (in file `Code/addition.cpp`)
```{Rcpp Rcpp-addition, eval=FALSE}
#include <Rcpp.h>
using namespace Rcpp;
// [[Rcpp::export]]
int addition(int a, int b) {
  return a + b;
}
```

**R code**
```{r addition-r}
Rcpp::sourceCpp("Code/addition.cpp")
addition(2, 2)
```

### Rcpp advantages

**Thanks to `Rcpp::sourceCpp()`**

- Compile the C++ code

- Export the function to the R session

- Direct interchange of R objects (including S3, S4) between R and C++

- ... (many more, see `vignette("Rcpp-package")`)

## RcppGSL for fast random draws

### GSL and RcppGSL

\bcols
\bcol{0.1\textwidth}
\includegraphics[height=1.5cm]{figs/logo_GNU.png}
\ecol
\bcol{0.9\textwidth}

**GNU Scientific Library**

- Numerical library for C and C++ programmers

- Reliable random number generator algorithms

- Thoroughly tested and fast random number distributions

- Linear algebra (matrices and vectors)

- <https://www.gnu.org/software/gsl/>

\vspace{0.5cm}

**RcppGSL**

- Interface between R and GSL

- Using Rcpp to interface R and C

- <http://dirk.eddelbuettel.com/code/rcpp.gsl.html>

\ecol
\ecols

### GSL random number distributions

- GSL v2.6 includes **38 random number distributions** (see [GNU GSL](https://www.gnu.org/software/gsl/doc/html/randist.html))

- It's easy to implement additional random number distributions from the GSL base distributions (e.g. truncated normal distribution)

- For comparison, R API includes "only" 24 random number distributions (see [Writing R Extensions](https://cran.r-project.org/doc/manuals/r-release/R-exts.html#Distribution-functions))

- Random draws are faster with GSL than with R (eg. `gsl_ran_gamma()` vs. `R::rgamma()`)

## RcppArmadillo for high-performance linear algebra

### Armadillo and RcppArmadillo

\bcols
\bcol{0.1\textwidth}
\includegraphics[height=1.5cm]{figs/logo_Armadillo.png}  
\ecol
\bcol{0.9\textwidth}

**Armadillo**

- C++ library for linear algebra and scientific computing

- Provides high-level syntax and functionality: speed and ease of use

- Classes for vectors, matrices and cubes

- Matrix operations, matrix decomposition, linear model solver, etc.

- <http://arma.sourceforge.net/>

\vspace{0.5cm}

**RcppArmadillo**

- Interface between R and Armadillo

- Using Rcpp to interface R and C++

- <http://dirk.eddelbuettel.com/code/rcpp.armadillo.html>

\ecol
\ecols

### Licenses

- Licenses: GNU General Public License, Apache License 2.0 for Armadillo
- Free software licenses: we can use, modify and redistribute these softwares

# Build of R package using Rcpp

## Usefull functions

### How to build an R package around C++ functions 

- `Rcpp.package.skeleton()` to generate a new Rcpp package (modifying `DESCRIPTION` and `NAMESPACE`)
  
- `Rcpp::compileAttributes()` scans the C++ files and generates the `RcppExports.cpp` file to make the functions preceded by `// [[Rcpp::export]]` available in R.

- Implement R functions that checks the conformity of user-defined parameters, calls functions in C++ and returns the results in an easy-to-use format.


## Example of package using Rcpp

### jSDM R package
\vspace{0.2cm}
\begin{center}
\includegraphics[width=0.9\textwidth, height = 0.65\textheight]{figs/jSDM-website.png}
\end{center}
\vspace{0.2cm}

- <https://ecology.ghislainv.fr/jSDM>
  
- Made with Rcpp* packages
